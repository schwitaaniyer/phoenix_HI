{% extends "base.html" %}
{% load crispy_forms_tags %}

{% block title %}IPS/IDS Configuration{% endblock %}

{% block content %}
<div id="ips-content">
    <div class="row">
        <div class="col-md-6">
            <div class="card mb-4">
                <div class="card-header">
                    <h4>IPS/IDS Service Control</h4>
                </div>
                <div class="card-body">
                    <div class="btn-group w-100">
                        <button class="btn btn-primary" id="startIps">Start Service</button>
                        <button class="btn btn-warning" id="restartIps">Restart Service</button>
                        <button class="btn btn-danger" id="stopIps">Stop Service</button>
                    </div>
                    <div class="mt-3">
                        <h5>Service Status</h5>
                        <pre id="ipsStatus">Loading...</pre>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="not-authorized" style="display:none;">{% include 'not_authorized.html' %}</div>
{% endblock %}

{% block extra_js %}
<script>
function loadIpsStatus() {
    fetch('/api/services/ips/status/')
        .then(r => r.json())
        .then(data => {
            if (data.status) {
                document.getElementById('ipsStatus').textContent = data.status;
            } else if (data.error) {
                if (data.error.includes('403')) {
                    document.getElementById('ips-content').style.display = 'none';
                    document.getElementById('not-authorized').style.display = '';
                } else {
                    document.getElementById('ipsStatus').textContent = data.error;
                }
            }
        });
}
document.addEventListener('DOMContentLoaded', function() {
    loadIpsStatus();
    document.getElementById('startIps').addEventListener('click', function() {
        fetch('/api/services/ips/control/', {
            method: 'POST',
            headers: {'X-CSRFToken': '{{ csrf_token }}'},
            body: new URLSearchParams({action: 'start'})
        }).then(() => loadIpsStatus());
    });
    document.getElementById('restartIps').addEventListener('click', function() {
        fetch('/api/services/ips/control/', {
            method: 'POST',
            headers: {'X-CSRFToken': '{{ csrf_token }}'},
            body: new URLSearchParams({action: 'restart'})
        }).then(() => loadIpsStatus());
    });
    document.getElementById('stopIps').addEventListener('click', function() {
        fetch('/api/services/ips/control/', {
            method: 'POST',
            headers: {'X-CSRFToken': '{{ csrf_token }}'},
            body: new URLSearchParams({action: 'stop'})
        }).then(() => loadIpsStatus());
    });
});
</script>
{% endblock %}