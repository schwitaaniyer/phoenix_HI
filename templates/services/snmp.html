{% extends "base.html" %}
{% load crispy_forms_tags %}

{% block title %}SNMP Configuration{% endblock %}

{% block content %}
<div id="snmp-content">
    <div class="row">
        <div class="col-md-6">
            <div class="card mb-4">
                <div class="card-header">
                    <h4>SNMP Service Control</h4>
                </div>
                <div class="card-body">
                    <div class="btn-group w-100">
                        <button class="btn btn-primary" id="startSnmp">Start SNMP</button>
                        <button class="btn btn-warning" id="restartSnmp">Restart SNMP</button>
                        <button class="btn btn-danger" id="stopSnmp">Stop SNMP</button>
                    </div>
                    <div class="mt-3">
                        <h5>Service Status</h5>
                        <pre id="snmpStatus">Loading...</pre>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="not-authorized" style="display:none;">{% include 'not_authorized.html' %}</div>
{% endblock %}

{% block extra_js %}
<script>
function loadSnmpStatus() {
    fetch('/api/services/snmp/status/')
        .then(r => r.json())
        .then(data => {
            if (data.status) {
                document.getElementById('snmpStatus').textContent = data.status;
            } else if (data.error) {
                if (data.error.includes('403')) {
                    document.getElementById('snmp-content').style.display = 'none';
                    document.getElementById('not-authorized').style.display = '';
                } else {
                    document.getElementById('snmpStatus').textContent = data.error;
                }
            }
        });
}
document.addEventListener('DOMContentLoaded', function() {
    loadSnmpStatus();
    document.getElementById('startSnmp').addEventListener('click', function() {
        fetch('/api/services/snmp/control/', {
            method: 'POST',
            headers: {'X-CSRFToken': '{{ csrf_token }}'},
            body: new URLSearchParams({action: 'start'})
        }).then(() => loadSnmpStatus());
    });
    document.getElementById('restartSnmp').addEventListener('click', function() {
        fetch('/api/services/snmp/control/', {
            method: 'POST',
            headers: {'X-CSRFToken': '{{ csrf_token }}'},
            body: new URLSearchParams({action: 'restart'})
        }).then(() => loadSnmpStatus());
    });
    document.getElementById('stopSnmp').addEventListener('click', function() {
        fetch('/api/services/snmp/control/', {
            method: 'POST',
            headers: {'X-CSRFToken': '{{ csrf_token }}'},
            body: new URLSearchParams({action: 'stop'})
        }).then(() => loadSnmpStatus());
    });
});
</script>
{% endblock %}